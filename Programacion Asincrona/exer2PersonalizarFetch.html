<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exercicio 2 Personalizar Fetch</title>
    <style>
        * {
            padding: 0;
            margin: 0;
            box-sizing: border-box;
        }

        body {
            width: 400px;
            margin: 10px auto;
            background-color: rgb(241, 241, 241);
            text-align: center;
        }

        form {
            display: flex;
            flex-direction: column;
            padding: 10px;
            gap: 5px;

        }

        form>* {
            padding: 10px;
        }

        .tarefa {
            border: 1px solid black;
            margin: 10px;
            padding: 10px;
            text-align: left;
        }


        .completado {
            background-color: rgb(106, 172, 106);
        }

        .nocompletado {
            background-color: rgb(255, 155, 155);
        }
    </style>
</head>

<body>
    <h1>Xestion de tarefas</h1>
    <form id="form">
        <input type="text" id="textinput" placeholder="Introduce unha tarefa" />
        <input type="button" id="engadir" value="+ Engadir Tarefa" />
    </form>
    <script>
        const body = document.getElementsByTagName("body")[0]
        const boton = document.getElementById("engadir")

        function cargarTarefasIniciais() {
            fetch("https://jsonplaceholder.typicode.com/todos?_limit=10")
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                    crearTarefas(data)
                })
        }

        //Función para crear unha tarefa
        function crearTarefa(post) {
            const div = document.createElement("div")
            div.classList = "tarefa"

            post.completed ? div.classList.add("completado") : div.classList.add("nocompletado")

            div.innerHTML = ` 
                <p><strong>Title: </strong>${post.title}</p>
                <p><strong>Completed: </strong>${post.completed}</p>
                <p><strong>Post ID: </strong>${post.id}</p>
                `

            body.appendChild(div)
        }

        //Función para crear as Tarefas iniciais
        function crearTarefas(posts) {
            posts.forEach(post => crearTarefa(post))

        }


        function apiCrearTarefa(titulo) {
            fetch('https://jsonplaceholder.typicode.com/posts', {
                method: 'POST',
                body: JSON.stringify({
                    userId: 1,
                    title: `${titulo}`,
                    completed: false,
                }),
                headers: {
                    'Content-type': 'application/json; charset=UTF-8'
                }
            })
                .then((response) => response.json())
                .then((json) => {
                    console.log(json);
                    crearTarefa(json);
                });
        }





        cargarTarefasIniciais()

        boton.addEventListener("click", (e) => {
            e.preventDefault

            const textinput = document.getElementById("textinput")

            if (textinput.value) {
                apiCrearTarefa(textinput.value)
                textinput.value = ""
            }

        })


    </script>
</body>

</html>